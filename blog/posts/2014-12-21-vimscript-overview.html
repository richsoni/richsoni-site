<html>
  <head>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="RichSoni.com" href="/feed.xml">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
      <title>Rich Soni - On Vimscript</title>
    
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <meta name="viewport" content="initial-scale=1">
    <!-- <link rel="stylesheet" href="/assets/bundles/app.css"> -->
    <!-- <link rel="stylesheet" type="text/css" media="print" href="/assets/bundles/print.css" > -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link href='https://fonts.googleapis.com/css?family=Shadows+Into+Light' rel='stylesheet' type='text/css'>
    <script src="/bundle.js"></script>
    <meta property="og:url" content="/" />
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="On Vimscript" />
    <meta property="og:image" content="" />
    <link rel="apple-touch-icon" sizes="57x57" href="/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <style>
      body {
        margin: 0;
        padding: 0;
        clear: both;
        font-family: 'Helvetica Neue', HelveticaNeue, Arial, sans-serif;
        max-width: 960px;
        margin: auto auto;
        padding-bottom: 50px;
        background-color: #232323;
      }
      a {
        color: #428bca;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      @-webkit-keyframes pulse {
        from {
            -webkit-transform: scale(1.0);
          }
        50% {
            -webkit-transform: scale(1.1);
          }
        to {
            -webkit-transform: scale(1.0);
          }
      }

      .pulse:hover {
        -webkit-animation-name: pulse;
        -webkit-animation-duration: .7s;
        -webkit-animation-iteration-count: 4;
      }

      .hoverDim a {
        color: #fff;
        transition: all ease-in-out .7s;
      }
      .hoverDim:hover a {
        color: #3C3C3C;
      }
      .hoverDim a:hover {
        border-color: white;
        color: white;
      }

      .hoverFade i{
        transition: all ease-in-out .7s;
      }

      .hoverFade:hover .inactive .fa-inverse{
        color: #bebebe !important;
      }

      .hoverFade .inactive .fa-inverse:hover {
        border-color: #000 !important;
        color: #000 !important;
      }

      .hoverFade:hover *:not(.inactive) .fa-stack-2x{
        color: #bebebe !important;
      }
    </style>
  </head>
  <body>
    <p><a class='caption' target="_blank" href='https://www.flickr.com/photos/elijahporter/8218473966/in/photolist-dwePo7-hXWnuU-eb1Zwu-hXWewi-hXWxbf-nEnvu4-dwePZ1-ozFjeY-dweP9Y-ozTwTH-hXWdnp-hXX5wa-hXWvvw-ozTyHz-hXWsfy-hXWgEs-ozRCyS-6zzL8F-hXWaSz-dsCcus-dsCbVm-dw9eZn-dweNPC-hXW3uZ-ozBAyg-dw9fpX-hXWZvP-dweR9u-jE9wH1-dw9ewp-fEFWJb-dtC7ou-hCRZi1-oBbFPF-dw9iWZ-dKazBG-hCSjAh-dkkC7x-oBbvr7-nFAsin-fjwf33-hCS1am-hCSbqj-hCSZRa-hCRJwB-ag4ZFM-MGzDJ-53o4h2-p5tpND-p5tpta/'>Header Photo credit to Elijah Porter </a></p>
<h1>View The Talk</h1>
<p>I presented this material at the New York Vim Meetup.
View the presentation below:</p>
<iframe width="560" height="315" src="http://www.youtube.com/embed/WfyXKnQ9kAQ" frameborder="0" allowfullscreen></iframe>
<h1>Here I Dreamt I Was An Architect</h1>
<blockquote>
<p>&quot;Design is not making beauty, beauty emerges from selection, affinities, integration, love.&quot; ~ Louis Kahn</p>
</blockquote>
<aside class='col-xs-6'>
  <img class='img-responsive' src='/blog/posts/images/four_freedoms_map.png' >
  <div class='caption'>
  The Four Freedoms Park, sandwiched between Manhattan and Long Island
  </div>
</aside>
<p>The <a href="http://www.fdrfourfreedomspark.org/">Four Freedoms Park</a>(image above) is an architectural masterpiece designed by <a href="http://www.biography.com/people/louis-kahn-37884">Louis Khan</a>.
The park's architecture embellishes its riverfront property which lies between Manhattan and Long Island.
Instead of competing with the environment, <a href="http://www.biography.com/people/louis-kahn-37884">Khan</a> often designs architecture which leverages it.</p>
<p>This same principles define well crafted Vimscript.
Celebrated Vimscript authors (e.g. <a href="https://github.com/tpope">tpope</a>, <a href="https://github.com/tommcdo">tommcdo</a>, and <a href="https://github.com/AndrewRadev">AndrewRadev</a>) compliment vim's features with their plugins.
Design at this level requires a comprehensive understanding of vim, and its swath of functionality.
<em>Great Vimscript feels natural to vim users</em>.
This is just as important as writing something useful.</p>
<p>If limited to one piece of advice to Vimscript authors, I would offer this:
<em>Compliment your environment, do not compete with it.</em>
This article builds off of this concept, and extends advice on how to author great Vimscript.</p>
<h1>Building A Foundation</h1>
<p>Conceptualizing certain ideas is a prerequisite to authoring exceptional Vimscript.
These next sections offer a variety of such ideas.
The aim is to <em>prime the mind into recognizing good problems to solve with Vimscript</em>, and to compress the learning curve of the language.</p>
<h2>Customization Over Origination</h2>
<p>Most Vimscripts serve one of the two following functions:</p>
<ol>
<li>Customize/extend built-in settings</li>
<li>Enhance the editor with brand new functionality</li>
</ol>
<p>In either situation, a single principal prevails:
<em>Straying from Vim's convictions often creates more work, and a less polished solution.</em>
It's not hard to find code that breaks this rule, and it hurts the community when code like gets released.
It bloats the codebase, and teaches bad habits.</p>
<h3>Customization Example: File Browsing</h3>
<p><a href="https://github.com/scrooloose/nerdtree">NerdTree</a> is a popular plugin that enables file browsing a' la TextMate's project drawer.
The plugin duplicates a large amount of existing code (netrw), and has a significant functionality flaw.
Drew Neil eloquently phrases how project drawers and Vim splits mix like <a href="http://vimcasts.org/blog/2013/01/oil-and-vinegar-split-windows-and-project-drawer/">Oil and vinegar</a>.</p>
<p>Another option, <a href="https://github.com/tpope/vim-vinegar">vim-vinegar</a>plays nicely with splits and leverages existing netrw code.
Instead of reinventing functionality, vinegar improves netrw with slick configurations.</p>
<p>What is the gain?<br>
Qualitatively, <a href="https://github.com/tpope/vim-vinegar">vim-vinegar</a>feels more natural to a user adapted to vim's native functionality.<br>
Quantitatively, <a href="https://github.com/tpope/vim-vinegar">vim-vinegar</a>is <em>5x smaller</em> than <a href="https://github.com/scrooloose/nerdtree">NerdTree</a>(529 kb vs 2775 kb).</p>
<h4>Resources</h4>
<ol>
<li><code>:h netrw</code></li>
<li><a href="https://github.com/tpope/vim-vinegar">vim-vinegar</a></li>
<li><a href="http://vimcasts.org/blog/2013/01/oil-and-vinegar-split-windows-and-project-drawer/">Oil and vinegar</a></li>
<li><a href="https://github.com/scrooloose/nerdtree">NerdTree</a></li>
</ol>
<h3>Augmentation Example: Swapping Text</h3>
<p>Yet, there are circumstances which vim provides no feasable solution.
A great example is swapping text.
Examine the example swapping &quot;bar&quot; and &quot;baz&quot; using nothing but stock vim commands.
It amounts to 15 keystrokes, and to revert the operation requires 2 undo commands.</p>
<pre><code><span class="hljs-string">"foo [b]ar baz"</span>
<span class="hljs-list">(<span class="hljs-keyword">viwy</span> w viwp bb viwp)</span>
<span class="hljs-string">"foo [baz] bar"</span>
</code></pre>
<p>The plugin <a href="https://github.com/tommcdo/vim-exchange">vim-exchange</a>, wraps this functionality into one swift command.
Examine the same operation with <a href="https://github.com/tommcdo/vim-exchange">vim-exchange</a>(9 keystrokes, and 1 undo).</p>
<pre><code><span class="hljs-string">"foo [b]ar baz"</span>
<span class="hljs-list">(<span class="hljs-keyword">cxiw</span> w cxiw)</span>
<span class="hljs-string">"foo [baz] bar"</span>
</code></pre>
<p>A key to the design of this plugin is interface to the end user.
The mapping <code>cx</code> does not clobber any vim functionality.
The command is an operator so things like <code>cxaw</code> and <code>cxx</code> work.
These details make the plugin flow with vim.</p>
<h4>References</h4>
<ol>
<li><a href="https://github.com/tommcdo/vim-exchange">vim-exchange</a></li>
<li><code>:h operator</code></li>
</ol>
<h2>Cause And Effect</h2>
<p>Vim is <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html#autocmd-events-abc">event</a>focused.
It's waiting for things to happen (sequences of keypresses).
When one such trigger occurs, actions fire.
Callbacks respond to these <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html#autocmd-events-abc">events</a>.</p>
<p><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/23.html" title="Learn Vimscript The Hard Way - Functions">Functions</a>bind to key sequences (<a href="http://learnvimscriptthehardway.stevelosh.com/chapters/03.html" title="Learn Vimscript The Hard Way - Basic Mapping">mappings</a>, commands, <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/08.html" title="Learn Vimscript The Hard Way - Abbreviations">abbreviations</a>) and <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html#autocmd-events-abc">events</a>(<a href="http://learnvimscriptthehardway.stevelosh.com/chapters/12.html" title="Learn Vimscript The Hard Way - Autocommands">autocommands</a>).
Here are some examples:</p>
<pre><code>nmap ge ibeep&lt;cr&gt;
iabbrev beep boop
command Beep :<span class="hljs-attribute">normal</span>!(<span class="hljs-string">"iboop"</span>)

autocmd FileType markdown <span class="hljs-function"><span class="hljs-title">echo</span><span class="hljs-params">(<span class="hljs-string">'beepboop'</span>)</span></span>
</code></pre>
<p>Choosing the right <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html#autocmd-events-abc">event</a>a piece of Vimscript should bind to can make the design more clean / useful.</p>
<h4>Resources</h4>
<ol>
<li><code>:h map.txt</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/03.html" title="Learn Vimscript The Hard Way - Basic Mapping">Learn Vimscript The Hard Way - Basic Mapping</a></li>
<li><code>:h abbrev</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/08.html" title="Learn Vimscript The Hard Way - Abbreviations">Learn Vimscript The Hard Way - Abbreviations</a></li>
<li><code>:h command</code></li>
<li><code>:h normal</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/29.html" title="Learn Vimscript The Hard Way - Normal">Learn Vimscript The Hard Way - Normal</a></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/30.html" title="Learn Vimscript The Hard Way - Execute Normal!">Learn Vimscript The Hard Way - Execute Normal!</a></li>
<li><code>:h autocmd</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/12.html" title="Learn Vimscript The Hard Way - Autocommands">Learn Vimscript The Hard Way - Autocommands</a></li>
<li><code>:h echo</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/01.html" title="Learn Vimscript The Hard Way - Echoing Messages">Learn Vimscript The Hard Way - Echoing Messages</a></li>
</ol>
<h1>On Learning Syntax</h1>
<p>This article refrains from explicitly covering Vimscript syntax.
Attepts at writing a tutorial would be subpar to these more comprehsive tutorials:</p>
<ol>
<li>The harder / quicker path: <code>:h usr_41.txt</code></li>
<li>The easier / slower path:  <a href="http://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></li>
</ol>
<p>Each resource provides detailed information on syntax and technical details required when writing Vimscript.
They each take a unique approach to essentially the same material.
<em>After reading either piece, you should be comfortable with basic Vimscript.</em>
Albeit, less palpable aspects may still be insipid.
The aim of this article is to fill some of those missing pieces.</p>
<p>The remaining sections offer tidbits of wisdom I aquired through experience.
One section covers Vimscript itself, while the other targets writing plugins.</p>
<h4>Resources</h4>
<ol>
<li><code>:h usr_41.txt</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></li>
</ol>
<h1>Hacking Vim Script</h1>
<p>Once you know Vimscript, opportunities for productivity boosts emerge.
This section presents some ideas that will assist your efforts to learn Vimscript.</p>
<h2>Don't Prematurely Write Plugins</h2>
<p>Write Vimscript for yourself before broadcasting it to the world.
<em>When starting out it's important to write a lot of actual code.</em>
Plugins require documentation, and degrees of design that bring their own challenges.
This will take away from the learning process of the language.</p>
<h2>Poking The Box</h2>
<p>Obviously, Vimscript is best written within vim.
Doing this offers conveniences that are impossible to recreate in another editor.
Namely, a gateway to an instant feedback loop via runtime evaluation.
<em>Instead of guessing how a piece of code will behave, vim supports trying it immediately.</em>
Below are a handful of methods for evaluating Vimscript at runtime.</p>
<h3>Evaluating Files</h3>
<p>The primary runtime evaluation tool is the <code>:source</code> command.
This command accepts a path to a file as an argument, and loads it into vim's runtime.
This avoids having to close and open vim again.</p>
<pre><code class="language-vim">:source ~/.vim/init/keybindings.vim
</code></pre>
<h4>Pro Tips</h4>
<ol>
<li>Add <code>!</code> to the end of <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/23.html" title="Learn Vimscript The Hard Way - Functions">functions</a>, allowing them to reload.</li>
<li><code>:so</code> is the same as <code>:source</code></li>
<li><code>:source %</code> will load the current file</li>
</ol>
<p>Here are some reloadable code examples:</p>
<pre><code class="language-vim">nmap ge :echo('beep')&lt;CR&gt;
iabbrev beep boop
command! Beep normal! iboop
function! BeepBoop()
  echo('beep')
endfunction
</code></pre>
<h4>Resources</h4>
<ol>
<li><code>:h so</code></li>
<li><code>:h function</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/23.html" title="Learn Vimscript The Hard Way - Functions">Learn Vimscript The Hard Way - Functions</a></li>
</ol>
<h3>Inspecting</h3>
<p><em>Command mode is not a REPL</em> for Vimscript.
As such, other means of interaction need to exist.
The simplest strategy is <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/01.html" title="Learn Vimscript The Hard Way - Echoing Messages">echo</a>.</p>
<pre><code class="language-vim">:let g:beep='boop'
:g:beep
:echo(g:beep)
:1 + 1
:echo(1+1)
</code></pre>
<p>It's useful to <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/01.html" title="Learn Vimscript The Hard Way - Echoing Messages">echo</a>out <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/19.html" title="Learn Vimscript The Hard Way - Variables">variables</a>, but can get cumbersome with longer experssions.
<a href="https://github.com/tpope">Tpope</a>'s <a href="https://github.com/tpope/vim-scriptease">scriptease</a>plugin offers some facilities to allieviate this.</p>
<p>The <code>g!</code> is an operator that replaces the text with evaluated Vimscript.
For example, running <code>g!!</code> on the line <code>1 + 1</code> would change the line to <code>2</code>.</p>
<p><code>:PP</code> opens a REPL for evaluating Vimscript.</p>
<pre><code class="language-vim">:PP
PP&gt; system('ls')
"CNAME\n_config.yml\n_includes\n_layouts\n_posts\n_publish\n_site\nassets\nbin\ncontact.html\ncss\nfeed\nfonts\nimages\nimg\nindex.html\njs\nnode_modules\npac
kage.json\nresume.html\nsass\nsrc\ntest\ntodo.txt\n"
</code></pre>
<h4>Resources</h4>
<ol>
<li><code>:h command</code></li>
<li><code>:h g:</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/19.html" title="Learn Vimscript The Hard Way - Variables">Learn Vimscript The Hard Way - Variables</a></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/20.html" title="Learn Vimscript The Hard Way - Variable Scoping">Learn Vimscript The Hard Way - Variable Scoping</a></li>
<li><code>:h echo</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/01.html" title="Learn Vimscript The Hard Way - Echoing Messages">Learn Vimscript The Hard Way - Echoing Messages</a></li>
<li><a href="https://github.com/tpope/vim-scriptease">scriptease</a></li>
<li><code>:h scriptease</code></li>
</ol>
<h2>Use The OS</h2>
<p>The operating system provides a lot of functionality, and its smart to leverage it.
Calling <code>system</code> exposes unix commands to vim.</p>
<pre><code>echo<span class="hljs-list">(<span class="hljs-keyword">system</span><span class="hljs-list">(<span class="hljs-quoted">'ls</span>')</span>)</span>
echo<span class="hljs-list">(<span class="hljs-keyword">system</span><span class="hljs-list">(<span class="hljs-quoted">'ls</span> -lal '.expand<span class="hljs-list">('%')</span>)</span>)</span>
</code></pre>
<h4>Resources</h4>
<ol>
<li><code>:h system</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/52.html" title="Learn Vimscript The Hard Way - External Commands">Learn Vimscript The Hard Way - External Commands</a></li>
<li><code>:h expand</code></li>
</ol>
<h2>State Up To Date</h2>
<p>The key to Vimscript is understanding how to manipulate vim's state.
There are 3 main ways to interact with application state in vim:</p>
<ol>
<li>Passively reading current state</li>
<li>Updating state</li>
<li>Binding to an <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html#autocmd-events-abc">event</a>broadcasted when state changes</li>
</ol>
<p>Most Vimscript functionality employs one of these interactions.</p>
<h3>Reading State</h3>
<p>Variables govern the state and behavior of vim.
Variable namespacing is systematic in Vimscript.
Here are the different types of variables:</p>
<p><strong>g:variables</strong> - global variables<br>
Globals preserve value in any situation within vim.
This means any mode, and any buffer.
A frequent use of these variables is to memoize plugin loading.</p>
<pre><code><span class="hljs-attribute">:echo(g:loaded_fugitive)</span>
&gt; 1
</code></pre>
<p><strong>s:variables</strong> - script local<br>
These variables have scope limited to their file.
This allows 2 scripts to have the same variable, but not collide.</p>
<pre><code class="language-vim"><span class="hljs-keyword">let</span> <span class="hljs-variable">s:counter</span> = <span class="hljs-number">0</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>! <span class="hljs-title">MyCounter</span><span class="hljs-params">()</span></span>
  <span class="hljs-keyword">let</span> <span class="hljs-variable">s:counter</span> = <span class="hljs-variable">s:counter</span> + <span class="hljs-number">1</span>
  <span class="hljs-keyword">echo</span>(<span class="hljs-variable">s:counter</span>)
<span class="hljs-keyword">endfunction</span>
</code></pre>
<p><strong>b:variables</strong> - buffer local<br>
These variables bind to the current buffer.
Syntax specific functionality is a great usecase for them.</p>
<pre><code class="language-vim">:echo(b:did_ftplugin)
&gt; 1
</code></pre>
<p><strong>$VARIABLES</strong> - Environment<br>
All environment variables carry over from the shell.
Like the shell, dollar signs ($) prefix environment variables.</p>
<pre><code>:echo(<span class="hljs-variable">$PAGER</span>)
&gt; less
</code></pre>
<p><strong>&amp;variables</strong> - Set options<br>
Calling <code>set filetype=markdown</code> is a wrapper to vim's option variables.</p>
<pre><code>:<span class="hljs-function"><span class="hljs-title">echo</span><span class="hljs-params">(&amp;tabstop)</span></span>
&gt; <span class="hljs-number">2</span>
</code></pre>
<p><strong>@variable</strong> - register variables<br>
The registers are global containers to save values.
Macros save into single digit global registers(0-9a-z).
Access to these registers via <code>@</code> in Vimscript.</p>
<pre><code><span class="hljs-symbol">:let</span> <span class="hljs-variable">@d</span>=<span class="hljs-string">'ggdG'</span>
<span class="hljs-symbol">:echo</span>(<span class="hljs-variable">@d</span>)
&gt; ggdG
</code></pre>
<h4>Buffer State</h4>
<p>Some buffer state is not available via variables.
This makes vim faster because it does not need to constantly write changing data.
<em>It will lazy-load this information via certain functions it provides.</em>
Consider this example of reading the current line:</p>
<pre><code class="language-vim">:echo(line('.'))
&gt; 262
</code></pre>
<h4>Resources</h4>
<ol>
<li><code>:h variables</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/19.html" title="Learn Vimscript The Hard Way - Variables">Learn Vimscript The Hard Way - Variables</a></li>
<li><code>:h line</code></li>
</ol>
<h3>Updating State</h3>
<p>Whenever you interact with vim you are updating runtime state.
A call to <code>:set filetype=markdown</code> will update the <code>&amp;filetype</code> variable.
Typing <code>gg</code> will move the current line.
<code>:w</code> tells vim to execute its buffer writing sequence.</p>
<p>State updates are similar in Vim and Vimscript.
The main ways to update state are as follows:</p>
<p>(Note <code>.</code> concats <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/26.html" title="Learn Vimscript The Hard Way - Strings">strings</a>in Vimscript)</p>
<p><strong>let</strong> - updates a variables state</p>
<pre><code>   <span class="hljs-keyword">let</span> &amp;<span class="hljs-keyword">filetype</span>=<span class="hljs-string">'markdown'</span>
   <span class="hljs-keyword">let</span> <span class="hljs-variable">g:script_loaded</span>=<span class="hljs-number">1</span>
</code></pre>
<p><strong>execute</strong> - evaluates a string as an ex (:) command</p>
<pre><code>  <span class="hljs-instruction"> execute </span><span class="hljs-string">":w "</span>.expand('%'<span class="hljs-function">)</span>
</code></pre>
<p><strong>normal!</strong> - executes commands as if a user typed them</p>
<pre><code>   normal! gg=G
  <span class="hljs-instruction"> execute </span><span class="hljs-string">"normal! "</span>.commands
</code></pre>
<p><strong>eval</strong> - evaluates a string as Vimscript</p>
<pre><code>   eval('<span class="hljs-keyword">let</span> <span class="hljs-annotation">@r</span>=<span class="hljs-string">"gg=G"</span>)
</code></pre>
<h4>Resources</h4>
<ol>
<li><code>:h :set</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/02.html" title="Learn Vimscript The Hard Way - Setting Options">Learn Vimscript The Hard Way - Setting Options</a></li>
<li><code>:h :let</code></li>
<li><code>:h :execute</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/28.html" title="Learn Vimscript The Hard Way - Execute">Learn Vimscript The Hard Way - Execute</a></li>
<li><code>:h :normal</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/29.html" title="Learn Vimscript The Hard Way - Normal">Learn Vimscript The Hard Way - Normal</a></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/30.html" title="Learn Vimscript The Hard Way - Execute Normal!">Learn Vimscript The Hard Way - Execute Normal!</a></li>
<li><code>:h :eval</code></li>
<li><code>:h :expand</code></li>
</ol>
<h3>Listening For State Changes</h3>
<p>Vim is constantly changing state.
Your code can listen to these events by subscribing to them.</p>
<h4>Keyboard Events</h4>
<p>Vim has 2 main modes for subscribing to keyboard events: <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/03.html" title="Learn Vimscript The Hard Way - Basic Mapping">mappings</a>, and <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/08.html" title="Learn Vimscript The Hard Way - Abbreviations">abbreviations</a>.
<a href="http://learnvimscriptthehardway.stevelosh.com/chapters/03.html" title="Learn Vimscript The Hard Way - Basic Mapping">Mappings</a>can be global, or mode-specific:</p>
<pre><code><span class="hljs-attribute">:map  &lt;f12&gt; :h&lt;cr&gt;</span>
<span class="hljs-attribute">:imap &lt;c-c&gt; &lt;esc&gt;:w&lt;cr&gt;</span>
:nmap ZJ JZZ
</code></pre>
<p><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/08.html" title="Learn Vimscript The Hard Way - Abbreviations">Abbreviations</a>work in insert, command, and replace mode.
The tell vim to replace one set of text with another.</p>
<pre><code>cabbrev W w
<span class="hljs-keyword">abbrev</span> teh <span class="hljs-operator">the</span>
iabbrev yo you
</code></pre>
<h4>Autocommands</h4>
<p><a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html#autocmd-events-abc">Events</a>fire in vim when stuff happens.
Vimscript functions can bind to these <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html#autocmd-events-abc">events</a>.
<a href="http://learnvimscriptthehardway.stevelosh.com/chapters/12.html" title="Learn Vimscript The Hard Way - Autocommands">Autocommands</a>expose this functionality (see the <a href="#CauseAndEffect">Cause and Effect</a> section above).</p>
<h4>Resources</h4>
<ol>
<li><code>:h map</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/03.html" title="Learn Vimscript The Hard Way - Basic Mapping">Learn Vimscript The Hard Way - Basic Mapping</a></li>
<li><code>:h abbrev</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/08.html" title="Learn Vimscript The Hard Way - Abbreviations">Learn Vimscript The Hard Way - Abbreviations</a></li>
<li><code>:h autocmd</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/12.html" title="Learn Vimscript The Hard Way - Autocommands">Learn Vimscript The Hard Way - Autocommands</a></li>
</ol>
<h1>Plugin Design / Best Practices</h1>
<p>After achieving comfort with Vimscript, the next logical step is to write useful scripts and share them with the world.
The easiest way to share is via <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/42.html" title="Learn Vimscript The Hard Way - Plugin Layout in the Dark Ages">plugins</a>.</p>
<h2>Structuring</h2>
<p>In general, there are 2 main types of <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/42.html" title="Learn Vimscript The Hard Way - Plugin Layout in the Dark Ages">plugins</a>: global (<a href="https://github.com/tpope/vim-fugitive">fugitive</a>, <a href="https://github.com/AndrewRadev/splitjoin.vim">splitjoin</a>, <a href="https://github.com/tommcdo/vim-exchange">vim-exchange</a>), and filetype specific (<a href="https://github.com/tpope/vim-rails">vim-rails</a>).
The structure can vary, but here is a simplified template for each:</p>
<h3>Global Plugin</h3>
<ol>
<li>doc</li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/53.html" title="Learn Vimscript The Hard Way - Autoloading">autoload</a></li>
<li>plugin</li>
</ol>
<p>For a global plugin, the general formula is simple: expose your plugin within the plugin directory, and autoload everything else.
When starting out, <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/53.html" title="Learn Vimscript The Hard Way - Autoloading">autoload</a>may be overkill, but read <code>:h autoload</code> to prime your brain to use it in the future.</p>
<h3>FT Plugin</h3>
<ol>
<li>doc</li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/44.html" title="Learn Vimscript The Hard Way - Detecting Filetypes">ftdetect</a></li>
<li>ftplugin</li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/45.html" title="Learn Vimscript The Hard Way - Basic Syntax Highlighting">syntax</a></li>
</ol>
<p>Filetype plugins generally have a bit more meat to them.
<a href="http://learnvimscriptthehardway.stevelosh.com/chapters/44.html" title="Learn Vimscript The Hard Way - Detecting Filetypes">Ftdetect</a>evaluates the filetype.
<a href="http://learnvimscriptthehardway.stevelosh.com/chapters/45.html" title="Learn Vimscript The Hard Way - Basic Syntax Highlighting">Syntax</a>outlines rules for vims syntax highlighter.
Ftplugin is where buffer specific code resides.</p>
<h2>Loading</h2>
<p><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/42.html" title="Learn Vimscript The Hard Way - Plugin Layout in the Dark Ages">Plugins</a>should memoize themselves (unless under development).
To make sure they don't load twice, guard files with a snippet like this:</p>
<pre><code class="language-vim"><span class="hljs-keyword">if</span> <span class="hljs-built_in">exists</span>(<span class="hljs-string">"g:loaded_gitgutter"</span>)
  <span class="hljs-keyword">finish</span>
<span class="hljs-keyword">endif</span>
<span class="hljs-keyword">let</span> <span class="hljs-variable">g:loaded_gitgutter</span> = <span class="hljs-number">1</span>
</code></pre>
<h2>The Deal With SID and Plug</h2>
<h3>SID</h3>
<p>Plugins can leverage the <code>&lt;SID&gt;</code> feature offered by Vim.
Imagine this circumstance:</p>
<pre><code class="language-vim">""""""""""""""""""
"pluginA.vim
""""""""""""""""""
function! BeepBoop()
  echo('beep')
endfunction
nmap ge :call BeepBoop()&lt;cr&gt;

""""""""""""""""""
"pluginB.vim
""""""""""""""""""
function! BeepBoop()
  echo('boop')
endfunction
</code></pre>
<p>In this situation the mapping from pluginA, could actually call BeepBoop from pluginB depinding on the order in which scripts load.
To prevent this, the <code>&lt;SID&gt;</code> prefix expands to the <code>&lt;SNR&gt;</code> of the file.</p>
<pre><code class="language-vim">""""""""""""""""""
"pluginA.vim
""""""""""""""""""
function! s:BeepBoop()
  echo('beep')
endfunction
nmap ge :call &lt;SID&gt;BeepBoop()&lt;cr&gt;

""""""""""""""""""
"pluginB.vim
""""""""""""""""""
function! s:BeepBoop()
  echo('boop')
endfunction
</code></pre>
<p>Vim would expand that snippet to be this:</p>
<pre><code class="language-vim">"pluginA.vim
function! &lt;SNR&gt;48_BeepBoop()
  echo('beep')
endfunction
nmap ge :call &lt;SNR&gt;48_BeepBoop()&lt;cr&gt;

"pluginB.vim
function! &lt;SNR&gt;_87BeepBoop()
  echo('boop')
endfunction
</code></pre>
<p><em><code>&lt;SID&gt;</code> and <code>function s:name</code> make function names more explicit, and reliable.</em></p>
<h3>Plug</h3>
<p>The vim documentation says <code>&lt;Plug&gt;</code> is a &quot;special code that a typed key will never produce&quot;.
Unlike <code>&lt;SID&gt;, &lt;PLUG&gt;</code> is available to the global namespace.
It can expose a function call to the global environment.
Alas, <em>a user can access that function elsewhere.</em>
This allows them to attach their own keybinding to that function.
This globally living <code>&lt;Plug&gt;</code> code is the same for all plugins.
As such, use conventionally named commands like <code>&lt;Plug&gt;PluginnameFunc</code> to avoid collisions.</p>
<pre><code class="language-vim">"""""""""""
"plugin.vim
"""""""""""
noremap &lt;unique&gt; &lt;Plug&gt;PluginFunc :call &lt;SID&gt;VimScriptFn()&lt;CR&gt;

""""""""""""""""
"keybindings.vim
""""""""""""""""
:nmap _p &lt;Plug&gt;ScriptFunc
</code></pre>
<h4>Resources</h4>
<ol>
<li><code>:h plugins</code></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/42.html" title="Learn Vimscript The Hard Way - Plugin Layout in the Dark Ages">Learn Vimscript The Hard Way - Plugin Layout in the Dark Ages</a></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/44.html" title="Learn Vimscript The Hard Way - Detecting Filetypes">Learn Vimscript The Hard Way - Detecting Filetypes</a></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/45.html" title="Learn Vimscript The Hard Way - Basic Syntax Highlighting">Learn Vimscript The Hard Way - Basic Syntax Highlighting</a></li>
</ol>
<h1>Conclusion</h1>
<p>Vimscript is a useful language that one can learn in a short time.
The aim of this article is to highlight the best ways to use it.
When used in conjunction with <code>:h usr_41.txt</code> or <a href="http://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a> it should guide the reader to write exceptionally crafted Vimscript.
To reiterate the mantra from the beginning of this post: <em>Compliment your environment, do not compete with it.</em>
And, most of all have fun!!!</p>
<p>Please feel free to post questions in the comments section below.</p>
<h1>Resources</h1>
<ol>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a></li>
<li><a href="https://github.com/scrooloose/nerdtree">NerdTree</a></li>
<li><a href="http://vimcasts.org/blog/2013/01/oil-and-vinegar-split-windows-and-project-drawer/">Oil and vinegar</a></li>
<li><a href="https://github.com/tpope/vim-scriptease">scriptease</a></li>
<li><a href="https://github.com/tpope/vim-vinegar">vim-vinegar</a></li>
<li><code>:h :eval</code></li>
<li><code>:h :execute</code></li>
<li><code>:h :expand</code></li>
<li><code>:h :let</code></li>
<li><code>:h :normal</code></li>
<li><code>:h :set</code></li>
<li><code>:h abbrev</code></li>
<li><code>:h autocmd</code></li>
<li><code>:h command</code></li>
<li><code>:h echo</code></li>
<li><code>:h expand</code></li>
<li><code>:h function</code></li>
<li><code>:h g:</code></li>
<li><code>:h line</code></li>
<li><code>:h map.txt</code></li>
<li><code>:h map</code></li>
<li><code>:h netrw</code></li>
<li><code>:h normal</code></li>
<li><code>:h scriptease</code></li>
<li><code>:h so</code></li>
<li><code>:h system</code></li>
<li><code>:h usr_41.txt</code></li>
<li><code>:h variables</code></li>
</ol>

  </body> 
  <script> 
    var Component = App.pages['blog/posts']
    React.render(React.createElement(Component, {
      pathname: window.location.pathname
    }), document.body)
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-43693123-1', 'richsoni.com');
    ga('send', 'pageview');
  </script>
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=190656394463883";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>
  <script type='text/javascript'>var _merchantSettings=_merchantSettings || [];_merchantSettings.push(['AT', '10lsFa']);(function(){var autolink=document.createElement('script');autolink.type='text/javascript';autolink.async=true; autolink.src= ('https:' == document.location.protocol) ? 'https://autolinkmaker.itunes.apple.com/js/itunes_autolinkmaker.js' : 'http://autolinkmaker.itunes.apple.com/js/itunes_autolinkmaker.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(autolink, s);})();</script>
</html>
