{"data":{"markdownRemark":{"html":"<h1>Netlify</h1>\n<p> <strong><em><a href=\"https://www.netlify.com/\">Netlify</a>: \"An all-in-one workflow that combines global deployment, continuous integration, and automatic HTTPS. And that’s just the beginning\"</em></strong></p>\n<p><a href=\"https://www.netlify.com/\">Netlify</a> has been a popular static site hosting provider since around 2016 See (  </p>\n<ul>\n<li><a href=\"https://news.ycombinator.com/item?id=13021722\">Ask HN: What free or low-cost static site hosting do you use most?</a></li>\n<li><a href=\"https://www.savjee.be/2017/10/Static-website-hosting-who-is-fastest/\">Static website hosting: who's fastest? AWS, Google, Firebase, Netlify or GitHub?</a></li>\n<li><a href=\"https://www.slant.co/topics/2256/~best-static-website-hosting-provider\">What is the best static website hosting provider?</a></li>\n</ul>\n<p>); </p>\n<h1>Github Pages vs. Netlify</h1>\n<p>This site, has been hosted on <a href=\"https://pages.github.com/\">Github Pages</a> since 2013 (<em>See '<a href=\"/posts/2013-12-03-how-i-use-github-pages-to-host-my-blog/\">How I Use Github Pages to Host My Blog</a>'</em>).\nI am currently satisfied with using it as a hosting option for a site of this scale.\nHowever, some more complex projects may require the more sophisticated features offered by <a href=\"https://www.netlify.com/\">Netlify</a>.</p>\n<p>These features are outlined here: <em>'<a href=\"https://www.netlify.com/github-pages-vs-netlify/\">GITHUB PAGES VS. NETLIFY</a>: Netlify is the upgrade you're looking for'</em></p>\n<p>| feature |\n|Price\tFree\tFree\n|Build Limits\t10 Builds per hour\t3 Builds per minute\n|Custom Domains with HTTPS\tYes\tYes\n|1-click Rollbacks\tNo\tYes\n|Asset Optimizations\tNo\tYes\n|Form Handling\tNo\tYes\n|Deploy Previews\tNo\tYes\n|Continuous Deployment\tNo\tYes\n|Custom Rewrites &#x26; Redirects\tNo\tYes\n|Compatible w/All Static Site Generators\tNo\tYes\n|Prerendering\tNo\tYes\n|Split Testing\tNo\tYes\n|Lambda Functions Integration\tNo\tYes</p>\n<p>One of my first posts on this site, '' documented my experience using <a href=\"https://pages.github.com/\">Github Pages</a> to host my site.\nThat was back in 2013, and a lot has changed since then both on this site, and in technology offerings.</p>\n<p>In this post, I am going to work through launching a parallel build of my site on <a href=\"https://www.netlify.com/\">Netlify</a>.\nThis will allow me to evaluate it as an alternative to hosting via Github pages.</p>\n<h1>Initial Deploy</h1>\n<p>I followed <a href=\"https://www.netlify.com/blog/2016/09/29/a-step-by-step-guide-deploying-on-netlify/\">A Step-by-Step Guide: Deploying on Netlify</a>, which got my site up with only one small hiccup:</p>\n<h2>Cannot Resolve Module</h2>\n<p>My first builds spit out this error:</p>\n<pre><code>9:52:49 PM:   Error: ./src/pages/posts.tsx\n9:52:49 PM:   Module not found: Error: Can't resolve '../components/content/' in '/opt/build  /repo/src/pages'\n9:52:49 PM:   resolve '../components/content/' in '/opt/build/repo/src/pages'\n</code></pre>\n<p>Indeed my <code>posts.tsx</code> looked like this:</p>\n<pre><code>//./src/pages/posts.tsx\nimport Content from '../components/content/'\n</code></pre>\n<p>While the filesystem looked like this:</p>\n<pre><code>$ ls src/components/\nAlbumArtwork    FixedMenu       Logo            Table\nAlbumMediaCard  Footer          MailingListHalf Tabs\nBaseMeta        Half            MenuToggle      disqus\nBreadcrumbs     LatestRelease   OverlayMenu\nContent         Layout          ResponsiveMenu\nEventIndex      LocationMap.tsx SocialButton\n</code></pre>\n<p>Note the casing difference.  For some reason my machine allowed this casing mismatch, but Netlify did not.</p>\n<p>This issue took me a while to identify.  Here are some possible prevention tactics:\n[] Typescript: <a href=\"https://palantir.github.io/tslint/rules/file-name-casing/\">file-name-casing</a> rule would prevent, and automatically fix these issues in the future\n[] Using the <a href=\"https://github.com/netlify/build-image\">netlify-build-image</a> to develop could have identified this issue more quickly</p>\n<h1>The Site</h1>\n<p>The site is located here: <a href=\"https://vigilant-wiles-695009.netlify.com/\">https://vigilant-wiles-695009.netlify.com/</a></p>\n<h1>Developing with the netlify-build-image</h1>\n<p>It seemed valuable to <a href=\"https://github.com/netlify/build-image\">netlify-build-image</a> seemed to have a lot of benefits to me.  So, I decided to explore that option.</p>\n<h2>Setup</h2>\n<p>This also was pretty simple.  I followed the <a href=\"https://github.com/netlify/build-image#testing-locally\">Testing Locally</a> instructions, and they made sense, except for one confusing point:</p>\n<p><em>It was not clear that you had to clone the [netlify/build-image] repository</em>.</p>\n<p>I opened a Pull Request (<a href=\"https://github.com/netlify/build-image/pull/252\">https://github.com/netlify/build-image/pull/252</a>) with the tool to make the instructions more clear.\nHopefully they take the suggestions.</p>\n<h2>The Build</h2>\n<p>Since my build worked on Netlify, I expected to run <code>build yarn build</code> in the container without any issues.\nThis was inded the case:</p>\n<pre><code>~/code/github/netlify/build-image(master)------------------------------------------------------------------------\n$ ./test-tools/start-image.sh ~/code/personal/richsoni.github.io\nbuildbot@46702c0a6065:/$ build yarn build\nCloning into '/opt/buildhome/repo'...\ndone.\nInstalling dependencies\nAttempting node version '9.11.2' from .node-version\nDownloading and installing node v9.11.2...\nDownloading https://nodejs.org/dist/v9.11.2/node-v9.11.2-linux-x64.tar.xz...\nNow using node v9.11.2 (npm v5.6.0)\nStarted restoring cached node modules\nFinished restoring cached node modules\nStarted restoring cached yarn cache\nFinished restoring cached yarn cache\nInstalling yarn at version 1.3.2\nInstalling Yarn!\n> Downloading tarball...\nyarn install v1.3.2\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n[4/4] Building fresh packages...\nyarn run v1.3.2\n$ gatsby build\n... (gatsby doin' its thang)\nsuccess Building static HTML for pages — 2.202 s — 294/294 387.20 pages/second\ninfo Done building in 31.159 sec\nDone in 31.34s.\nCaching artifacts\nStarted saving node modules\nFinished saving node modules\nStarted saving yarn cache\nFinished saving yarn cache\nCached node version v9.11.2\n</code></pre>\n<h3>Reproducing the error</h3>\n<p>One thing to note from the README for <a href=\"https://github.com/netlify/build-image\">netlify-build-image</a> is the code to be tested needs to be committed tk.\nI added the error back:</p>\n<pre><code>//./src/pages/posts.tsx\nimport Content from '../components/content/'\n</code></pre>\n<p>Voila, the error is reproduced:</p>\n<pre><code>$ ./test-tools/start-image.sh ~/code/personal/richsoni.github.io       buildbot@50750cae5d63:/$ build yarn build\nCloning into '/opt/buildhome/repo'...\ndone.\nInstalling dependencies\nAttempting node version '9.11.2' from .node-version\nDownloading and installing node v9.11.2...\nDownloading https://nodejs.org/dist/v9.11.2/node-v9.11.2-linux-x64.tar.xz...\n#                                                                      ####                                                                   #######                                                                ##########                                                             #############                                                          #################                                                      ####################                                                   #######################                                                ##########################                                             #############################                                          ################################                                       ###################################                                    ######################################                                 ##########################################                             ############################################                           ###############################################                        ##################################################                     ####################################################                   ########################################################               ###########################################################            ##############################################################         #################################################################      ####################################################################   ############################################################################################################################################### 100.0%\nComputing checksum with sha256sum\nChecksums matched!\nNow using node v9.11.2 (npm v5.6.0)\nAttempting ruby version 2.3.6, read from environment\nUsing ruby version 2.3.6\nUsing PHP version 5.6\nStarted restoring cached node modules\nFinished restoring cached node modules\nStarted restoring cached yarn cache\nFinished restoring cached yarn cache\nInstalling yarn at version 1.3.2\nInstalling Yarn!\n> Downloading tarball...\n\n[1/2]: https://yarnpkg.com/downloads/1.3.2/yarn-v1.3.2.tar.gz --> /tmp/yarn.tar.gz.MpXOOZlnrV\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:-100    91  100    91    0     0    531      0 --:--:-- --:--:-- --:--:--   535\n  0     0    0   608    0     0   1707      0 --:--:-- --:--:-- --:--:--  1707\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:-100  865k  100  865k    0     0   656k      0  0:00:01  0:00:01 --:--:-- 1932k\n\n[2/2]: https://yarnpkg.com/downloads/1.3.2/yarn-v1.3.2.tar.gz.asc --> /tmp/yarn.tar.gz.MpXOOZlnrV.asc\n100    95  100    95    0     0   4368      0 --:--:-- --:--:-- --:--:--  4368\n  0     0    0   612    0     0   5133      0 --:--:-- --:--:-- --:--:--  5133\n100  1027  100  1027    0     0   7102      0 --:--:-- --:--:-- --:--:--  7102\n> Verifying integrity...\ngpg: Signature made Thu 02 Nov 2017 04:44:10 PM UTC using RSA key ID FD2497F5\ngpg: Good signature from \"Yarn Packaging &#x3C;yarn@dan.cx>\"\ngpg: Note: This key has expired!\nPrimary key fingerprint: 72EC F46A 56B4 AD39 C907  BBB7 1646 B01B 86E5 0310\n     Subkey fingerprint: 6A01 0C51 6600 6599 AA17  F081 46C2 130D FD24 97F5\n> GPG signature looks good\n> Extracting to ~/.yarn...\n> Adding to $PATH...\n> We've added the following to your /opt/buildhome/.profile\n> If this isn't the profile of your current shell then please add the following to your correct profile:\n\nexport PATH=\"$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH\"\n\n> Successfully installed Yarn 1.3.2! Please open another terminal where the `yarn` command will now be available.\nInstalling NPM modules using Yarn version 1.3.2\nyarn install v1.3.2\n[1/4] Resolving packages...\n[2/4] Fetching packages...\ninfo fsevents@1.2.4: The platform \"linux\" is incompatible with this module.\ninfo \"fsevents@1.2.4\" is an optional dependency and failed compatibility check. Excluding it from installation.\n[3/4] Linking dependencies...\nwarning \"gatsby > mini-css-extract-plugin > schema-utils > ajv-errors@1.0.0\" has unmet peer dependency \"ajv@>=5.0.0\".\nwarning \"gatsby-plugin-typescript > @babel/preset-typescript@7.1.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"gatsby-plugin-typescript > @babel/preset-typescript > @babel/plugin-transform-typescript@7.2.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"gatsby-plugin-typescript > @babel/preset-typescript > @babel/plugin-transform-typescript > @babel/plugin-syntax-typescript@7.2.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\nwarning \"gatsby-plugin-typescript-checker > fork-ts-checker-webpack-plugin@0.5.0\" has unmet peer dependency \"tslint@^4.0.0 || ^5.0.0\".\nwarning \"gatsby-plugin-typescript-checker > fork-ts-checker-webpack-plugin@0.5.0\" has unmet peer dependency \"webpack@^2.3.0 || ^3.0.0 || ^4.0.0\".\n[4/4] Building fresh packages...\nwarning Your current version of Yarn is out of date. The latest version is \"1.13.0\" while you're on \"1.3.2\".\ninfo To upgrade, run the following command:\n$ curl -o- -L https://yarnpkg.com/install.sh | bash\nDone in 27.33s.\nNPM modules installed using Yarn\nStarted restoring cached go cache\nFinished restoring cached go cache\n\nunset GOOS;\nunset GOARCH;\nexport GOROOT='/opt/buildhome/.gimme/versions/go1.10.linux.amd64';\nexport PATH=\"/opt/buildhome/.gimme/versions/go1.10.linux.amd64/bin:${PATH}\";\ngo version >&#x26;2;\n\nexport GIMME_ENV='/opt/buildhome/.gimme/env/go1.10.linux.amd64.env';\ngo version go1.10 linux/amd64\nInstalling missing commands\nVerify run directory\nExecuting user command: yarn build\nyarn run v1.3.2\n$ gatsby build\nsuccess open and validate gatsby-configs — 0.010 s\nsuccess load plugins — 0.229 s\nsuccess onPreInit — 0.747 s\nsuccess delete html and css files from previous builds — 0.008 s\nsuccess initialize cache — 0.009 s\nsuccess copy gatsby files — 0.050 s\nsuccess onPreBootstrap — 0.016 s\nsuccess source and transform nodes — 1.171 s\nsuccess building schema — 0.398 s\nsuccess createPages — 0.845 s\nsuccess createPagesStatefully — 0.053 s\nsuccess onPreExtractQueries — 0.000 s\nsuccess update schema — 0.273 s\nsuccess extract queries from components — 0.226 s\nsuccess run graphql queries — 11.809 s — 294/294 24.90 queries/second\nsuccess write out page data — 0.012 s\nsuccess write out redirect data — 0.003 s\nsuccess onPostBootstrap — 0.003 s\n\ninfo bootstrap finished - 18.818 s\n\n\nerror Generating JavaScript bundles failed\n\n\n  Error: ./src/pages/posts.tsx\n  Module not found: Error: Can't resolve '../components/content/' in '/  opt/buildhome/repo/src/pages'\n  resolve '../components/content/' in '/opt/buildhome/repo/src/pages'\n    Parsed request is a directory\n    using description file: /opt/buildhome/repo/package.json (relative   path: ./src/pages)\n      Field 'browser' doesn't contain a valid alias configuration\n      using description file: /opt/buildhome/repo/package.json (relativ  e path: ./src/components/content)\n        as directory\n          /opt/buildhome/repo/src/components/content doesn't exist\n  [/opt/buildhome/repo/src/components/content]\n   @ ./src/pages/posts.tsx 7:0-45 156:31-38\n   @ ./.cache/async-requires.js\n   @ ./.cache/production-app.js\n\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\nCaching artifacts\nStarted saving node modules\nFinished saving node modules\nStarted saving yarn cache\nFinished saving yarn cache\nStarted saving pip cache\nFinished saving pip cache\nStarted saving emacs cask dependencies\nFinished saving emacs cask dependencies\nStarted saving maven dependencies\nFinished saving maven dependencies\nStarted saving boot dependencies\nFinished saving boot dependencies\nStarted saving go dependencies\nFinished saving go dependencies\nCached node version v9.11.2\nbuildbot@50750cae5d63:/$\n</code></pre>\n<h1>Pulling in @netlify/build-image</h1>\n<p>The <a href=\"https://github.com/netlify/build-image\">netlify-build-image</a> project contains a <code>package.json</code> which is published to npm.</p>\n<p>I was able to add this as a development dependency to my project:</p>\n<pre><code>yarn add --dev netlify/build-image\n</code></pre>\n<p>Then I wrote a script which would execute the netlify build:</p>\n<pre><code>$ cat script/netlify-build\n#!/usr/bin/env bash\nDIR=`pwd`\ncd node_modules/@netlify/build-image\n./test-tools/test-build.sh $DIR\n</code></pre>\n<p>Then I added a build command to my package.json:</p>\n<pre><code>$ cat package.json | grep 'netlify:build'\n  \"netlify:build\": \"./script/netlify-build\"\n</code></pre>\n<p>This allows me to run the build locally:</p>\n<pre><code>yarn run netlify:build\n</code></pre>\n<p>I also created corresponding scripts for starting an image shell:</p>\n<pre><code>$ cat script/netlify-start-image\n\n#!/usr/bin/env bash\nDIR=`pwd`\ncd node_modules/@netlify/build-image\n./test-tools/start-image.sh $DIR\n\n$ cat package.json | grep 'netlify:start-image'\n\"netlify:start-image\": \"./script/netlify-start-image\"\n</code></pre>\n<p>And a shell can be accessed via:</p>\n<pre><code>yarn run netlify:start-image\n</code></pre>","frontmatter":{"title":"Building Richsoni.com with Netlify","hero":"/images/posts/2019-01-28-netlify-richsoni.png"},"fields":{"date":"2019-01-23"}}},"pageContext":{"url":"/posts/2019-01-23-experiment-netlify/"}}