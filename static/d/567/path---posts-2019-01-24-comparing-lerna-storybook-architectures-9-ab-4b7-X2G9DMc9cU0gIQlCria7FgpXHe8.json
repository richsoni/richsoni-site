{"data":{"markdownRemark":{"html":"<h1>‚öî Conflicting Philosophies</h1>\n<p>When creating a <a href=\"https://lernajs.io/\">Lerna</a> project with <a href=\"https://reactjs.org/\">React</a> and <a href=\"https://storybook.js.org\">Storybook</a>, there are two places in which <a href=\"https://storybook.js.org\">Storybook</a> can live:</p>\n<ul>\n<li>As a package managed by <a href=\"https://lernajs.io/\">Lerna</a></li>\n<li>As a sibling to <a href=\"https://lernajs.io/\">Lerna</a> in the project root</li>\n</ul>\n<p>There seems to be conflicting philosophies within the community when it comes to these two approaches:</p>\n<ul>\n<li><em>Root</em> - <a href=\"https://itnext.io/guide-react-app-monorepo-with-lerna-d932afb2e875\">Guide‚Ää‚Äî‚ÄäThe Multi CRA Lerna Monorepo</a></li>\n<li><em>Root</em> - <a href=\"https://github.com/Dohxis/lerna-starter-ts\">Dohxis/lerna-starter-ts</a></li>\n<li><em>Package</em> - <a href=\"https://github.com/FelixKuehl/cra-monorepo\">FelixKuehl/cra-monorepo</a></li>\n<li><em>Package</em> - <a href=\"https://github.com/nareshbhatia/lerna-workspaces-react-ts\">nareshbhatia/lerna-workspaces-react-ts</a></li>\n</ul>\n<p>While I am only including 2 of each, <em>including <a href=\"https://storybook.js.org\">Storybook</a> in the project root is way more popular</em>.</p>\n<p>I created <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-architecture-demo</a> which contains both architectures, so they can be compared side by side:</p>\n<ul>\n<li><a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-as-package</a> - <a href=\"https://lernajs.io/\">Lerna</a> project with <a href=\"https://storybook.js.org\">Storybook</a> installed at <code>packages/storybook</code></li>\n<li><a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a> - <a href=\"https://lernajs.io/\">Lerna</a> project with <a href=\"https://storybook.js.org\">Storybook</a> installed at <code>./</code></li>\n</ul>\n<h1>ü§ì My Take</h1>\n<p>While the method shown in <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a> is more popular, I cannot figure out why.\n<em>I see no benefit of architecting in with <a href=\"https://storybook.js.org\">Storybook</a> living in the project root</em>.</p>\n<p><em>Conversely, the <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-as-package</a> strategy has many advantages over <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a></em></p>\n<h2>üíÖ Less Clutter in Root</h2>\n<p>The root folder of <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-as-package</a> has one concern (<a href=\"https://lernajs.io/\">Lerna</a>), while <a href=\"%5BLerna%5D,%20%5BStorybook%5D\">storybook-in-root</a>.\nThis difference makes the <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a> file structure more disjointed:</p>\n<pre><code>$ ls -la storybook-as-package\ntotal 1448\ndrwxr-xr-x     8 rsoni  domain users     272 Jan 24 19:54 .\ndrwxr-xr-x     7 rsoni  domain users     238 Jan 24 19:53 ..\n-rw-r--r--     1 rsoni  domain users     111 Jan 24 18:07 lerna.json\ndrwxr-xr-x  1485 rsoni  domain users   50490 Jan 24 19:10 node_modules\n-rw-r--r--     1 rsoni  domain users     296 Jan 24 19:06 package.json\ndrwxr-xr-x     5 rsoni  domain users     170 Jan 24 18:34 packages\n-rw-r--r--     1 rsoni  domain users     366 Jan 24 19:54 readme.md\n-rw-r--r--     1 rsoni  domain users  727596 Jan 24 19:07 yarn.lock\n\n$ ls -la storybook-in-root\ntotal 1448\ndrwxr-xr-x    10 rsoni  domain users     340 Jan 24 19:55 .\ndrwxr-xr-x     7 rsoni  domain users     238 Jan 24 19:53 ..\ndrwxr-xr-x     4 rsoni  domain users     136 Jan 24 19:32 .storybook\n-rw-r--r--     1 rsoni  domain users     111 Jan 24 19:21 lerna.json\ndrwxr-xr-x  1485 rsoni  domain users   50490 Jan 24 19:32 node_modules\n-rw-r--r--     1 rsoni  domain users     618 Jan 24 19:32 package.json\ndrwxr-xr-x     4 rsoni  domain users     136 Jan 24 19:21 packages\n-rw-r--r--     1 rsoni  domain users     373 Jan 24 19:55 readme.md\ndrwxr-xr-x     3 rsoni  domain users     102 Jan 24 19:32 src\n-rw-r--r--     1 rsoni  domain users  727596 Jan 24 19:32 yarn.lock\n</code></pre>\n<p>In the <code>storybook-as-package</code> example the storybook setup script functions better:</p>\n<p>This pollution also extends to the <code>package.json</code>:</p>\n<pre><code>$ cat storybook-as-package/package.json\n{\n  \"name\": \"root\",\n  \"private\": true,\n  \"scripts\": {\n    \"build:all\": \"lerna run build --parallel\",\n    \"install:all\": \"lerna bootstrap &#x26;&#x26; lerna link\",\n    \"start:all\": \"lerna run start --parallel\"\n  },\n  \"devDependencies\": {\n    \"lerna\": \"^3.10.5\"\n  },\n  \"workspaces\": [\n    \"packages/*\"\n  ]\n}\n\n$ cat storybook-in-root/package.json\n{\n  \"name\": \"root\",\n  \"private\": true,\n  \"scripts\": {\n    \"build:all\": \"lerna run build --parallel\",\n    \"install:all\": \"lerna bootstrap &#x26;&#x26; lerna link\",\n    \"start:all\": \"lerna run start --parallel\",\n    \"storybook\": \"start-storybook -p 9009\",\n    \"build-storybook\": \"build-storybook\"\n  },\n  \"devDependencies\": {\n    \"lerna\": \"^3.10.5\",\n    \"@storybook/react\": \"^4.1.11\",\n    \"@storybook/addon-actions\": \"^4.1.11\",\n    \"@storybook/addon-links\": \"^4.1.11\",\n    \"@storybook/addons\": \"^4.1.11\",\n    \"@babel/core\": \"^7.2.2\",\n    \"babel-loader\": \"^8.0.5\"\n  },\n  \"workspaces\": [\n    \"packages/*\"\n  ],\n  \"dependencies\": {}\n}\n</code></pre>\n<p><em>For onboarding new developers to the project, keeping things simple is a huge advantage.</em>\n<em>The less complexity the better.</em></p>\n<h3>üì° Dependency Management</h3>\n<p>Since <a href=\"https://storybook.js.org\">Storybook</a> is managed by the root <code>package.json</code> in <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a>, commands like <code>lerna bootstrap</code> and <code>lerna link</code> do not work.</p>\n<p>When <a href=\"https://storybook.js.org\">Storybook</a> is managed by <a href=\"https://lernajs.io/\">Lerna</a>, <code>peerDepenencies</code> (React, Flow, Typescript), can be properly resolved.</p>\n<p>Additionally, <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-as-package</a> mimicks real work imports better thank <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a>:</p>\n<pre><code>$ cat storybook-in-root/src/stories/index.js | grep ExternalComponent\nimport ExternalComponent from \"../../packages/external-component/dist/index.es\";\n\n$ cat storybook-as-package/packages/storybook/src/stories/index.js | grep ExternalComponent\nimport ExternalComponent from \"@lerna-storybook-demo/external-component\";\n</code></pre>\n<h3>üè† Local Development</h3>\n<p>With the <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-as-package</a> architecture, <a href=\"https://lernajs.io/\">Lerna</a> can serve <a href=\"https://storybook.js.org\">Storybook</a>, a <a href=\"https://reactjs.org/\">React</a> server, and build an External Library all in one <code>start</code> command: <code>\"start:all\": \"lerna run start --parallel\"</code>.</p>\n<p>With <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a>, a separate <code>yarn storybook</code> server is required.</p>\n<h1>‚úåÔ∏è ‚úåÔ∏èConclusion</h1>\n<p><em>I see no reason to go with <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a></em>.  There are no apparent advantages it has over <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-as-package</a>.  While <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-as-package\">storybook-as-package</a> has many over <a href=\"https://github.com/richsoni/lerna-storybook-architecture-demo/tree/master/storybook-in-root\">storybook-in-root</a>.</p>","frontmatter":{"title":"Comparing Lerna-Storybook Architectures","hero":"/images/posts/lerna-storybook.jpg"},"fields":{"date":"2019-01-24"}}},"pageContext":{"url":"/posts/2019-01-24-comparing-lerna-storybook-architectures/"}}