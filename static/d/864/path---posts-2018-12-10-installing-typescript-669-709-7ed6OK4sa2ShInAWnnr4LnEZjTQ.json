{"data":{"markdownRemark":{"html":"<p>I recently upgraded richsoni.com to Gatsby version 2.0, <a href=\"https://www.richsoni.com/posts/2018-11-29-gatsby-2-upgrade/\">read about it in this previous post</a>.\nI was under the assumption that this would cure all my typescript woes, based on <a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">the release notes for Gatsby 2</a>.\nHowever, to my disappointment, this was not the case.</p>\n<p>It took a bit of research, and some elbow grease to get my build to behave as I would expect it.\nHowever, after some tribulation, it is now working the way I want it to.</p>\n<h1>Rename A JS file to Typescript</h1>\n<p>The first thing I did was rename a file, <code>src/util/data.js</code>, to <code>src/util/data.tsx</code>.</p>\n<pre><code>export const eventsWithSetlist = (events) => {\n  return events\n    .edges\n    .map((e) => e.node)\n    .filter((e) => e.frontmatter.setlist)\n};\n\nexport const eventsBySong = (events, songs) => {\n  return eventsWithSetlist(events)\n  .reduce((songs, event) => {\n    (event.frontmatter.setlist || []).map((song) => {\n      if(!songs[song]) { songs[song] = [] }\n      songs[song].push(event.fields.date)\n    });\n    return songs;\n  }, {});\n}\n\nexport const eventsWithSong = (events, song) => {\n  return events\n    .edges\n    .filter((event) => event.node.frontmatter.setlist)\n    .filter((event) => event.node.frontmatter.setlist.includes(song));\n}\n\nexport const nodesByBasename = (collection) => {\n  return collection.edges.map((e) => e.node).reduce((nodesByBasename, node) => {\n    return {...nodesByBasename,\n      [node.fields.basename]: node,\n    };\n  }, {})\n};\n</code></pre>\n<p>I chose this file because it has no dependencies, and it is small.\nMy reasoning was that this would minimize the variables to examine, and prove that typescript is indeed supported.</p>\n<p>I tried to run <code>gatsby-develop</code>, expecting some typescript errors, but was faced with none.</p>\n<p>I saw this listed in the <code>caveats</code> section of <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-typescript\">gatsby-plugin-typescript</a>:</p>\n<blockquote>\n<p>This plugin uses babel-plugin-transform-typescript to transpile typescript. It does not do type checking. Also since the TypeScript compiler is not involved, the following applies:</p>\n</blockquote>\n<h2>Type Checking</h2>\n<p>Its not very useful to write typescript, and not get any type errors show to you.</p>\n<p>I found this plugin: <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-typescript-checker/?=check\">gatsby-plugin-typescript-checker</a>.\nThe README, for that plugin states:</p>\n<blockquote>\n<p>gatsby-plugin-typescript adds TypeScript transpilation but not type checking. This plug adds fork-ts-checker-webpack-plugin to Gatsby to display type errors in the browser and the command line.</p>\n</blockquote>\n<p>I followed the advice in the README, and installed the dependencies:</p>\n<pre><code>$ yarn add gatsby-plugin-typescript gatsby-plugin-typescript-checker\n</code></pre>\n<p>I also updated the <code>gatsby-config.js</code> file:</p>\n<pre><code>plugins: [\n  'gatsby-plugin-typescript',\n  'gatsby-plugin-typescript-checker',\n</code></pre>\n<p>However, when running <code>gatsby develop</code>, I was faced with a new error:</p>\n<pre><code>error Plugin gatsby-plugin-typescript-checker returned an error\n  Error: Cannot find module 'typescript'\n</code></pre>\n<p>So, I also added <code>typescript</code>:</p>\n<pre><code>$ yarn add typescript\n</code></pre>\n<p>I still got an error when I ran: <code>gatsby develop</code>:</p>\n<pre><code>error UNHANDLED REJECTION\n  Error: Cannot find \"tsconfig.json\" file. Please check webpack and Fork  TsCheckerWebpackPlugin configuration.\n  Possible errors:\n    - wrong `context` directory in webpack configuration (if   `tsconfig` is not set or is a relative path in fork plugi  n configuration)\n    - wrong `tsconfig` path in fork plugin configuration (sh  ould be a relative or absolute path)\n</code></pre>\n<p>I added the <code>tsconfig.json</code> from <a href=\"https://github.com/resir014/gatsby-starter-typescript-plus\">gatsby-starter-typescript-plus</a>:</p>\n<pre><code>{\n  \"compilerOptions\": {\n    \"module\": \"commonjs\",\n    \"target\": \"esnext\",\n    \"jsx\": \"preserve\",\n    \"lib\": [\"dom\", \"es2015\", \"es2017\"],\n    \"strict\": true,\n    \"noEmit\": true,\n    \"isolatedModules\": true,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"removeComments\": false,\n    \"preserveConstEnums\": true\n  },\n  \"include\": [\"./src/**/*\"]\n}\n</code></pre>\n<p>And voila, I started to see the errors I was interested in seeing:</p>\n<pre><code>27:71 Parameter 'node' implicitly has an 'any' type.\n    25 |\n    26 | export const nodesByBasename = (collection) => {\n  > 27 |   return collection.edges.map((e) => e.node).reduce((nodesByBasename, node) => {\n       |                                                                       ^\n    28 |     return {...nodesByBasename,\n    29 |       [node.fields.basename]: node,\n    30 |     };\nℹ ｢wdm｣: Failed to compile.\n</code></pre>\n<p>While not documented anywhere, it seems that <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-typescript\">gatsby-plugin-typescript</a>, only supports Gatsby 2, but is required for typescript support.\nI found only hints at this on sites like <a href=\"https://spectrum.chat/gatsby-js/general/babel-7-and-typescript~f7d91614-dd5f-4475-888b-84fb2f305c9a\">this one</a>.</p>\n<p>I decided to give installing <code>gatsby-plugin-typescript</code> a shot:</p>\n<pre><code>$ yarn add gatsby-plugin-typescript\n</code></pre>\n<p>This still gave me the same error:</p>\n<pre><code>ERROR in ./src/templates/songs.js\nModule not found: Error: Can't resolve '../utils/data' in 'src/templates'\n</code></pre>\n<p>I read throught the page for the plugin some more, and made a few more changes.</p>\n<p>First, I added some options to the <code>gatsby-config</code>.</p>\n<pre><code>$ git diff gatsby-config.js\n+    resolve: `gatsby-plugin-typescript`,\n+    options: {\n+      isTSX: true,\n+      allExtensions: true,\n+    }\n+  },\n</code></pre>\n<p>I also, added the <code>npm</code> command to run the type-check:</p>\n<pre><code>git diff package.json\n-    \"deploy\": \"gh-pages-clean &#x26;&#x26; gatsby build --prefix-paths &#x26;&#x26; gh-pages -b master -d public -r https://github.com/richsoni/richsoni.github.io.git\"\n+    \"deploy\": \"gh-pages-clean &#x26;&#x26; gatsby build --prefix-paths &#x26;&#x26; gh-pages -b master -d public -r https://github.com/richsoni/richsoni.github.io.git\",\n+    \"type-check\": \"tsc --noEmit\",\n</code></pre>\n<p>However, I still got the same error:</p>\n<pre><code>ERROR in ./src/templates/songs.js\nModule not found: Error: Can't resolve '../utils/data' in 'src/templates'\n</code></pre>\n<p>I thought it might be because my typescript is broken, so I ran <code>$ yarn type-check</code>, to see if there where any errors:</p>\n<pre><code>$ yarn type-check\nyarn run v1.12.3\n$ tsc --noEmit\n/bin/sh: tsc: command not found\n</code></pre>\n<p>The error, alluded that I am missing the <code>typescript</code> package, which comes with an executable command <code>tsc</code>.\nI added <code>typescript</code>.</p>\n<pre><code>$ yarn add typescript\n</code></pre>\n<p>I also needed, to add a <code>tsconfig.json</code>, for the command to work:</p>\n<pre><code></code></pre>\n<pre><code>$ git diff gatsby-config.js\n+  `gatsby-plugin-typescript-checker`,\n+  `gatsby-plugin-tslint`\n</code></pre>\n<pre><code>git diff gatsby-node.js\n-        const template = path.resolve(`./src/templates/${ty\npe}.js`);\n-        if(existsSync(template))\n+        const templatePath = path.resolve(`./src/templates/\n${type}.js`);\n+        const templateTSXPath = path.resolve(`./src/templat\nes/${type}.tsx`);\n+        const template = existsSync(templatePath) ? templatePath : existsSync(templateTSXPath) ? templateTSXPath : null\n+        if(template)\n</code></pre>\n<pre><code>git diff package.json\n+    \"lint\": \"tslint --project .\"\n\n+    \"@types/react\": \"^16.7.13\",\n+    \"@types/react-dom\": \"^16.0.11\",\n+    \"@types/react-image-fallback\": \"^8.0.0\",\n\n+    \"gatsby-plugin-tslint\": \"^0.0.2\",\n+    \"gatsby-plugin-typescript\": \"^2.0.3\",\n+    \"gatsby-plugin-typescript-checker\": \"^1.0.2\",\n\n\n+    \"tslint\": \"^5.11.0\",\n+    \"tslint-config-prettier\": \"^1.17.0\",\n+    \"tslint-loader\": \"^3.5.4\",\n+    \"tslint-react\": \"^3.6.0\",\n+    \"typescript\": \"^3.2.2\"\n</code></pre>","frontmatter":{"title":"Installing Typescript on richsoni.com","hero":"/images/posts/gatsby-logo.jpg"},"fields":{"date":"2018-12-10"}}},"pageContext":{"url":"/posts/2018-12-10-installing-typescript/"}}