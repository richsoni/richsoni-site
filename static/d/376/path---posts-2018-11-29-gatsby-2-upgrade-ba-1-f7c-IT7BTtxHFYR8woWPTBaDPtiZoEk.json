{"data":{"markdownRemark":{"html":"<p>In the summer the codebase for richsoni.com was converted from <a href=\"https://jekyllrb.com/\">Jekyll</a> to <a href=\"https://gatsbyjs.org\">Gatsby</a>.\nA few weeks later, the Gatsby team <a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">announced the release of Gatsby v2</a>.<br>\nC'est la vie.</p>\n<p>After weeks of migrating data and code from Jekyll to Gatsby, I had no interest in doing an update from Gatsby 1.9 to Gatsby 2.0.\nHowever, my interest was piqued this week, after a few murky attempts at installing <a href=\"https://www.npmjs.com/package/gatsby-plugin-typescript/\">gatsby-plugin-typescript</a>.\nIt turns out that <a href=\"https://www.typescriptlang.org/\">Typescript</a> is bundled by default in Gatsby V2, making <a href=\"https://www.npmjs.com/package/gatsby-plugin-typescript/\">gatsby-plugin-typescript</a> unnecessary.\nThis was enough reason for me to perform the update.</p>\n<h1>The Update Path</h1>\n<p>The update itself took a few hours, and was not too painful.\nAlthough some changes where required, and some issues where discovered.</p>\n<p>Listed on the <a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">Gatsby V2 Announcement Page</a> was a link to a <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/\">Gatsby V1 to V2 Migration Guide</a> the team put together.\nDuring my own update, I found this article to be very helpful and informative.</p>\n<p>However, in all honesty, I followed my own update strategy:</p>\n<ol>\n<li>Upgrade Versions</li>\n<li>Fix All Yarn Errors and Warnings</li>\n<li>Build</li>\n<li>Fix All Build Errors and Warnings</li>\n<li>Look At The Page</li>\n<li>Fix All Visual Errors</li>\n<li>Go through <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/\">Gatsby V1 to V2 Migration Guide</a> to make sure I did not miss anything</li>\n</ol>\n<p>There where some hiccups along the way, but I was able to complete the update in about 3 hours.</p>\n<h1>Upgrading Versions</h1>\n<p>The first thing the <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/\">Gatsby V1 to V2 Migration Guide</a> recommends is <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#update-gatsby-version\">Upgrading The Gatsby Version</a>\nThis was my first thought as well.</p>\n<h3>Step 1: Upgrade Gatsby Version</h3>\n<pre><code>yarn upgrade gatsby --latest\n</code></pre>\n<p>After running this command, I was challenged with several errors &#x26; warnings.\nThey all alluded to depending on Gatsby V1 instead of V2.\nTo save some time, I just upgraded everything.</p>\n<h3>Step 2: Just Upgrade Everything</h3>\n<pre><code>yarn upgrade --latest\n</code></pre>\n<p>After this command, there where much less errors &#x26; warnings, but still a few.\nI used <code>yarn outdated</code> and <code>yarn check</code> to investigate:</p>\n<pre><code>$ yarn check\nyarn check v1.10.1\nerror \"ajv#json-schema-traverse@^0.4.1\" doesn't satisfy found match of \"json-schema-traverse@0.3.1\"\nerror \"regenerator-runtime\" is wrong version: expected \"0.11.1\", got \"0.10.5\"\nerror \"gatsby-plugin-pathdata#gatsby@1.x\" doesn't satisfy found match of \"gatsby@2.0.59\"\nerror \"gatsby#@babel/polyfill#regenerator-runtime@^0.11.1\" doesn't satisfy found match of \"regenerator-runtime@0.10.5\"\nwarning \"chokidar#fsevents#node-pre-gyp@^0.10.0\" could be deduped from \"0.10.3\" to \"node-pre-gyp@0.10.3\"\nerror \"ajv#json-schema-traverse\" is wrong version: expected \"0.4.1\", got \"0.3.1\"\nwarning \"eslint#ajv#json-schema-traverse@^0.3.0\" could be deduped from \"0.3.1\" to \"json-schema-traverse@0.3.1\"\nwarning \"relay-compiler#babel-polyfill#regenerator-runtime@^0.10.5\" could be deduped from \"0.10.5\" to \"regenerator-runtime@0.10.5\"\nerror \"relay-compiler#babel-runtime#regenerator-runtime@^0.11.0\" doesn't satisfy found match of \"regenerator-runtime@0.10.5\"\nwarning \"table#ajv#json-schema-traverse@^0.3.0\" could be deduped from \"0.3.1\" to \"json-schema-traverse@0.3.1\"\ninfo Found 4 warnings.\nerror Found 6 errors.\n</code></pre>\n<p>The only module I recognized in <code>yarn check</code>'s output was <em>gatsby-plugin-pathdata</em>.</p>\n<h2>The Unmaintained <em>gatsby-plugin-pathdata</em> Library</h2>\n<p>Its a developers worst nightmare:</p>\n<ul>\n<li><em>You are new to a framework</em></li>\n<li><em>You run into a requirement not described in the 'tutorial'</em></li>\n<li><em>You find only one plugin does what you need</em></li>\n<li><em>You realize this plugin is not well maintained</em></li>\n<li><em>You still lack the knowledge to write your own plugin</em></li>\n<li><em>You reluctantly add it, hoping that there are no issues</em></li>\n</ul>\n<p><em>Voil√†!</em> You get something like this:</p>\n<pre><code>error \"gatsby-plugin-pathdata#gatsby@1.x\" doesn't satisfy found match of \"gatsby@2.0.59\"\n</code></pre>\n<p>I tested the <code>gatsby develop</code> command, and it did not complain about that plugin.\nAt this point, I decided to put <em>gatsby-plugin-pathdata</em> off to the side.</p>\n<p><strong>At the end of the migration I created an issue on the Github page for gatsby-plugin-pathdata and continued on with my life: <a href=\"https://github.com/barskern/gatsby-plugin-pathdata/issues/1\">https://github.com/barskern/gatsby-plugin-pathdata/issues/1</a></strong></p>\n<h3>First Commit</h3>\n<p>Here are the changes made to the package.json (the first commit of the upgrade):</p>\n<pre><code>git diff package.json\n-  \"gatsby\": \"^1.9.277\",\n-  \"gatsby-link\": \"^1.6.46\",\n+  \"gatsby\": \"^2.0.0\",\n+  \"gatsby-link\": \"^2.0.7\",\n\n-  \"gatsby-plugin-react-helmet\": \"^2.0.11\",\n-  \"gatsby-plugin-typography\": \"^1.7.19\",\n-  \"gatsby-source-filesystem\": \"^1.5.39\",\n-  \"gatsby-transformer-remark\": \"^1.7.44\",\n-  \"gatsby-transformer-yaml\": \"^1.5.18\",\n+  \"gatsby-plugin-react-helmet\": \"^3.0.3\",\n+  \"gatsby-source-filesystem\": \"^2.0.10\",\n+  \"gatsby-transformer-remark\": \"^2.1.14\",\n+  \"gatsby-transformer-yaml\": \"^2.1.6\",\n</code></pre>\n<h1>Gatsby Develop</h1>\n<p>The next thing I tried was to build my site with <code>gatsby develop</code>.\nThis produced an onslaught of errors and warnings.</p>\n<h2>React</h2>\n<p>The first error I saw was this:</p>\n<pre><code>This dependency was not found:\n\n* react in ./src/pages/index.js\n</code></pre>\n<p>I checked the <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#manually-install-react\">Gatsby V1 to V2 Migration Guide</a>, and it states:\n<em>In v1, the react and react-dom packages were included as part of the gatsby package. They are now peerDependencies so you are required to install them into your project.</em></p>\n<p>I added <code>react</code> <code>prop-types</code> and <code>react-dom</code>, and some errors and warnings went away.</p>\n<h3>Second Commit</h3>\n<pre><code>git diff package.json\n+  \"prop-types\": \"^15.6.2\",\n+  \"react\": \"^16.6.3\",\n+  \"react-dom\": \"^16.6.3\",\n</code></pre>\n<h2>ESLint</h2>\n<p>The next set of warnings I tackled was those which resembled this:</p>\n<pre><code>Warning: React version not specified in eslint-plugin-react settings. See https://github.com/yannickcr/eslint-plugin-react#configuration.\n</code></pre>\n<p>I did not have ESLint installed in my project, so I was confused.\nI searched quite a bit, and could find nowhere stating the ESlint was now required.\nHowever, I simply followed the <a href=\"https://github.com/yannickcr/eslint-plugin-react#configuration\">link from the warning</a>, which recommended adding a <code>.eslintrc</code>.\nThe ESlint errors went away!</p>\n<h3>Third Commit</h3>\n<pre><code>git diff .eslintrc\n+  {\n+    \"extends\": [\"eslint:recommended\", \"plugin:react/recommended\"]\n+  }\n</code></pre>\n<h1>Import GraphQL</h1>\n<p>Next I saw many warnings like the following:</p>\n<pre><code>warning Using the global `graphql` tag is deprecated, and will not be supported in v3.\nImport it instead like:  import { graphql } from 'gatsby' in file:\n</code></pre>\n<p>I did ran a quick vim macro to update all of these:</p>\n<pre><code>vim `git jump grep graphql`\nVIM MACRO: qq}Oimport {graphql} from 'graphql'\u0003:w\n:argnext\nq\n</code></pre>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby\">https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby</a></p>\n<h1>BoundActionCreators</h1>\n<p>There was only one more error:</p>\n<pre><code>boundActionCreators is deprecated. Please use actions instead. For migration instructions, see https://gatsby.app/boundActionCreators\nCheck the following files:\n\narchive/2018-08-04/bundle.js\n</code></pre>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#rename-boundactioncreators-to-actions\">The docs</a> outline the change that needs to be made.\nHowever, I still saw the error after I changed boundActionCreators to just <code>actions</code>.</p>\n<p>I realized the file was not part of my Gatsby project.</p>\n<p>After some poking around I concluded this was a bug in Gatsby itself.</p>\n<p>While my file was not being imported by Webpack, Gatsby was still scanning it for boundActionCreators.</p>\n<p>I opened an issue: <a href=\"https://github.com/gatsbyjs/gatsby/issues/10211\">https://github.com/gatsbyjs/gatsby/issues/10211</a></p>\n<p>This issue was not breaking my build, so I went to Chrome, and looked at my page.</p>\n<h1>Visit Page</h1>\n<p>The only major visual issue, was my navigation was missing.\nI remembered reading a section about this in the update guide.</p>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby\">https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby</a></p>\n<p>Had to do this in two places:</p>\n<ul>\n<li>Home Page index had to import Layout</li>\n<li>I already had a ContentPage Layout, so I just imported the base Layout there</li>\n</ul>\n<h1>Go through guide</h1>\n<p>After that, I read through the guide, and made only 1 other commit to remove explicit query names because I don't like them.</p>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#explicit-query-names-no-longer-required\">https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#explicit-query-names-no-longer-required</a></p>\n<pre><code>export const query = graphql`\n-  query ThisIsExplicitQueryName($slug: String!) {\n+  query($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      html\n      frontmatter {\n        title\n      }\n    }\n  }\n</code></pre>","frontmatter":{"title":"Upgrading richsoni.com To Gatsby 2","hero":"/images/posts/gatsby-logo.jpg"},"fields":{"date":"2018-11-29"}}},"pageContext":{"url":"/posts/2018-11-29-gatsby-2-upgrade/"}}