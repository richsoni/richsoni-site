{"data":{"markdownRemark":{"html":"<p>In September, <a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">Gatsby 2.0</a> was released.</p>\n<p>I upgraded my site from Jekyll to Gatsby around August, only to find out a month later that a major update happened.<br>\nC'est la vie.</p>\n<p>Recently, I decided to add <a href=\"https://www.typescriptlang.org/\">typescript</a> to my site.</p>\n<p>After a few murky attempts, I realized that among other features, Gatsby 2.0 also has builtin typescript support.</p>\n<p>The update was pretty painless.  Although some changes where required.</p>\n<p>I found (the Gatsby upgrade guide)[https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#rename-boundactioncreators-to-actions] to be very helpful and informative.</p>\n<p>However, in all honesty, I followed my own upgrade strategy:</p>\n<ol>\n<li>Upgrade Gatsby</li>\n<li>Fix all Yarn errors and warnings</li>\n<li>Run <code>gatsby develop</code></li>\n<li>Fix all <code>gatsby develop</code> errors and warnings</li>\n<li>Load the site</li>\n<li>Fix all visual errors</li>\n<li>Go through (the Gatsby upgrade guide)[https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#rename-boundactioncreators-to-actions] to make sure I did not miss anything</li>\n</ol>\n<p>There where some hiccups along the way, but I was able to complete the upgrade in about 3 hours.</p>\n<h1>Upgrade</h1>\n<p>I could not figure out how to upgrade my yarn packages.\nFirst I tried this:</p>\n<pre><code>yarn upgrade-interactive\n</code></pre>\n<p>I selected Gatsby, but it did not upgrade to 2.0.0 since the version was '1.9.277'.\nAfter some Googling, I tried:</p>\n<pre><code>yarn upgrade gatsby --latest\n</code></pre>\n<p>This did the trick.</p>\n<p>Then I got brave and ran:</p>\n<pre><code>yarn upgrade --latest\n</code></pre>\n<p>Which successfully ran, but it spit out a bunch of warnings.\nI used <code>yarn outdated</code> and <code>yarn check</code> to figure out which packages where actually broken.</p>\n<p>This is when I ran into my first issue.</p>\n<h2>gatsby-pathdata outdated</h2>\n<p>Its a developers worst nightmare: You are new to a framework, and need to do something weird.\nYou find only one plugin that does what you want, and its not maintained, but you are not knowledgable yet to write your own.\nYou reluctantly add it, hoping that there are no issues.</p>\n<p>Then voila! you get something like this:</p>\n<pre><code>error \"gatsby-plugin-pathdata#gatsby@1.x\" doesn't satisfy found match of \"gatsby@2.0.59\"\n</code></pre>\n<p>I decided to ignore it, and see if I could survive.\nIt turns out I could.\nSo, at the end of the migration I created an issue on github and continued on with my life: <a href=\"https://github.com/barskern/gatsby-plugin-pathdata/issues/1\">https://github.com/barskern/gatsby-plugin-pathdata/issues/1</a> </p>\n<p>Here are the changes I made to my package.json:</p>\n<pre><code>diff package.json\n-  \"gatsby\": \"^1.9.277\",\n-  \"gatsby-link\": \"^1.6.46\",\n+  \"gatsby\": \"^2.0.0\",\n+  \"gatsby-link\": \"^2.0.7\",\n\n-  \"gatsby-plugin-react-helmet\": \"^2.0.11\",\n-  \"gatsby-plugin-typography\": \"^1.7.19\",\n-  \"gatsby-source-filesystem\": \"^1.5.39\",\n-  \"gatsby-transformer-remark\": \"^1.7.44\",\n-  \"gatsby-transformer-yaml\": \"^1.5.18\",\n+  \"gatsby-plugin-react-helmet\": \"^3.0.3\",\n+  \"gatsby-source-filesystem\": \"^2.0.10\",\n+  \"gatsby-transformer-remark\": \"^2.1.14\",\n+  \"gatsby-transformer-yaml\": \"^2.1.6\",\n</code></pre>\n<h1>Gatsby Develop</h1>\n<p>The next thing I did was run <code>gatsby develop</code>.\nI was hoping for no errors, but instead I saw a ton.</p>\n<h2>React</h2>\n<p>The first error I saw was this:</p>\n<pre><code>This dependency was not found:\n\n* react in ./src/pages/index.js\n</code></pre>\n<p>This is the first time I went back to (the Gatsby upgrade guide)[https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#rename-boundactioncreators-to-actions]\nThey have instructions <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#manually-install-react\">here</a> which state:</p>\n<p><em>In v1, the react and react-dom packages were included as part of the gatsby package. They are now peerDependencies so you are required to install them into your project.</em></p>\n<p><code>npm i react react-dom</code></p>\n<p>I added them, and the error went away.</p>\n<h2>ESLint</h2>\n<p>Next I saw errors from ESLint:</p>\n<pre><code>Warning: React version not specified in eslint-plugin-react settings. See https://github.com/yannickcr/eslint-plugin-react#configuration.\n</code></pre>\n<p>I did not have ESLint in my project, so I was confused.\nI searched quite a bit, and could find nowhere stating the ESlint was now required.\nHowever, I simply followed the link from the error after that, and added this file that repo suggested:</p>\n<pre><code>cat .eslintrc\n  {\n    \"extends\": [\"eslint:recommended\", \"plugin:react/recommended\"]\n  }\n</code></pre>\n<p>The ESlint errors went away!</p>\n<h1>Upgrade Packages</h1>\n<pre><code>+  \"prop-types\": \"^15.6.2\",\n+  \"react\": \"^16.6.3\",\n+  \"react-dom\": \"^16.6.3\",\n</code></pre>\n<h1>Import GraphQL</h1>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby\">https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby</a></p>\n<h1>Cleanup Webpack Modules</h1>\n<h1>Move Layout</h1>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby\">https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-graphql-from-gatsby</a></p>\n<p>Had to do this in two places:</p>\n<ul>\n<li>Home Page index had to import Layout</li>\n<li>I already had a ContentPage Layout, so I just imported the base Layout there</li>\n</ul>\n<h1>Remove Explicit Query Names</h1>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#explicit-query-names-no-longer-required\">https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#explicit-query-names-no-longer-required</a></p>\n<pre><code>export const query = graphql`\n-  query ThisIsExplicitQueryName($slug: String!) {\n+  query($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      html\n      frontmatter {\n        title\n      }\n    }\n  }\n</code></pre>\n<h1>BoundActionCreators</h1>\n<p><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#rename-boundactioncreators-to-actions\">https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#rename-boundactioncreators-to-actions</a></p>\n<h1>Gatsby Plugin Pathdata</h1>\n<p>\"gatsby-plugin-pathdata\": \"^1.0.3\",</p>\n<h1>Issue with develop command</h1>","frontmatter":{"title":"Upgrading richsoni.com to Gatsby 2","hero":"/images/posts/gatsby-logo.jpg"},"fields":{"date":"2018-11-29"}}},"pageContext":{"url":"/posts/2018-11-29-gatsby-2-upgrade/"}}