{"data":{"markdownRemark":{"html":"<p>I recently upgraded <a href=\"https://richsoni.com\">richsoni.com</a> to <a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">Gatsby version 2.0</a>, My previous post, <a href=\"https://www.richsoni.com/posts/2018-11-29-gatsby-2-upgrade/\">'Upgrading richsoni.com To Gatsby 2'</a>.\nI was under the assumption that this would cure all my typescript woes, based on <a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">the release notes for Gatsby 2</a>.\nHowever, to my disappointment, this was not the case.</p>\n<p>It took a bit of research, and some elbow grease to get my build to behave as I would expect it.\nHowever, after some tribulation, it is now working the way I want it to.</p>\n<h1>Rename A JS file to Typescript</h1>\n<p>The first thing I did was rename a file, <code>src/util/data.js</code>, to <code>src/util/data.tsx</code>.</p>\n<pre><code>export const eventsWithSetlist = (events) => {\n  return events\n    .edges\n    .map((e) => e.node)\n    .filter((e) => e.frontmatter.setlist)\n};\n\nexport const eventsBySong = (events, songs) => {\n  return eventsWithSetlist(events)\n  .reduce((songs, event) => {\n    (event.frontmatter.setlist || []).map((song) => {\n      if(!songs[song]) { songs[song] = [] }\n      songs[song].push(event.fields.date)\n    });\n    return songs;\n  }, {});\n}\n\nexport const eventsWithSong = (events, song) => {\n  return events\n    .edges\n    .filter((event) => event.node.frontmatter.setlist)\n    .filter((event) => event.node.frontmatter.setlist.includes(song));\n}\n\nexport const nodesByBasename = (collection) => {\n  return collection.edges.map((e) => e.node).reduce((nodesByBasename, node) => {\n    return {...nodesByBasename,\n      [node.fields.basename]: node,\n    };\n  }, {})\n};\n</code></pre>\n<p>I chose this file because it has no dependencies, and it is small.\nMy reasoning was that this would minimize the variables to examine, and prove that typescript is indeed supported.</p>\n<p>I tried to run <code>gatsby-develop</code>, expecting some typescript errors, but was faced with none.</p>\n<p>I saw this listed in the <code>caveats</code> section of <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-typescript\">gatsby-plugin-typescript</a>:</p>\n<blockquote>\n<p>This plugin uses babel-plugin-transform-typescript to transpile typescript. It does not do type checking. Also since the TypeScript compiler is not involved, the following applies:</p>\n</blockquote>\n<h2>Type Checking</h2>\n<p>Its not very useful to write typescript, and not get any type errors show to you.</p>\n<p>I found this plugin: <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-typescript-checker/?=check\">gatsby-plugin-typescript-checker</a>.\nThe README, for that plugin states:</p>\n<blockquote>\n<p>gatsby-plugin-typescript adds TypeScript transpilation but not type checking. This plug adds fork-ts-checker-webpack-plugin to Gatsby to display type errors in the browser and the command line.</p>\n</blockquote>\n<p>I followed the advice in the README, and installed the dependencies:</p>\n<pre><code>$ yarn add gatsby-plugin-typescript gatsby-plugin-typescript-checker\n</code></pre>\n<p>I also updated the <code>gatsby-config.js</code> file:</p>\n<pre><code>plugins: [\n  'gatsby-plugin-typescript',\n  'gatsby-plugin-typescript-checker',\n</code></pre>\n<p>However, when running <code>gatsby develop</code>, I was faced with a new error:</p>\n<pre><code>error Plugin gatsby-plugin-typescript-checker returned an error\n  Error: Cannot find module 'typescript'\n</code></pre>\n<p>So, I also added <code>typescript</code>:</p>\n<pre><code>$ yarn add typescript\n</code></pre>\n<p>I still got an error when I ran: <code>gatsby develop</code>:</p>\n<pre><code>error UNHANDLED REJECTION\n  Error: Cannot find \"tsconfig.json\" file. Please check webpack and Fork  TsCheckerWebpackPlugin configuration.\n  Possible errors:\n    - wrong `context` directory in webpack configuration (if   `tsconfig` is not set or is a relative path in fork plugi  n configuration)\n    - wrong `tsconfig` path in fork plugin configuration (sh  ould be a relative or absolute path)\n</code></pre>\n<p>I added the <code>tsconfig.json</code> from <a href=\"https://github.com/resir014/gatsby-starter-typescript-plus\">gatsby-starter-typescript-plus</a>:</p>\n<pre><code>{\n  \"compilerOptions\": {\n    \"module\": \"commonjs\",\n    \"target\": \"esnext\",\n    \"jsx\": \"preserve\",\n    \"lib\": [\"dom\", \"es2015\", \"es2017\"],\n    \"strict\": true,\n    \"noEmit\": true,\n    \"isolatedModules\": true,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"removeComments\": false,\n    \"preserveConstEnums\": true\n  },\n  \"include\": [\"./src/**/*\"]\n}\n</code></pre>\n<p>And voila, I started to see the errors I was interested in seeing:</p>\n<pre><code>27:71 Parameter 'node' implicitly has an 'any' type.\n    25 |\n    26 | export const nodesByBasename = (collection) => {\n  > 27 |   return collection.edges.map((e) => e.node).reduce((nodesByBasename, node) => {\n       |                                                                       ^\n    28 |     return {...nodesByBasename,\n    29 |       [node.fields.basename]: node,\n    30 |     };\nℹ ｢wdm｣: Failed to compile.\n</code></pre>\n<p>Now, I added some basic <code>any</code>, types to all of the variables:</p>\n<pre><code>export const eventsWithSetlist = (events: any) => {\n  return events\n    .edges\n    .map((e: any) => e.node)\n    .filter((e: any) => e.frontmatter.setlist)\n}\n\nexport const eventsBySong = (events: any) => {\n  return eventsWithSetlist(events)\n  .reduce((memo: any, event: any) => {\n    (event.frontmatter.setlist || []).map((song: any) => {\n      if(!memo[song]) { memo[song] = [] }\n      memo[song].push(event.fields.date)\n    })\n    return memo\n  }, {})\n}\n\nexport const eventsWithSong = (events: any, song: any) => {\n  return events\n    .edges\n    .filter((event: any) => event.node.frontmatter.setlist)\n    .filter((event: any) => event.node.frontmatter.setlist.includes(song))\n}\n\nexport const nodesByBasename = (collection: any) => {\n  return collection.edges.map((e: any) => e.node).reduce((memo: any, node: any) => {\n    return {...memo,\n      [node.fields.basename]: node,\n    }\n  }, {})\n}\n</code></pre>\n<p>And, voila, now Typescript works on my project!</p>\n<h1>My Recommendation</h1>\n<p>So, if I had to offer advice on getting Typescript, this is how I would present it:</p>\n<h2>Step 1 Install Dependencies</h2>\n<p>To add Typescript to a Gatsby 2.0 project, install the following:</p>\n<pre><code>$ yarn add gatsby-plugin-typescript gatsby-plugin-typescript-checker typescript`\n</code></pre>\n<h2>Step 2 Typescript Config</h2>\n<p>Setup tsconfig.json file.</p>\n<p>This can be done by doing <code>tsc --init</code>, or by copying and pasting a <code>tsconfig.json</code> from a different project.</p>\n<h2>Step 3 Gatsby Config</h2>\n<p>Finally, add the plugins to the <code>gatsby-config</code>:</p>\n<pre><code>...\nplugins: [\n  'gatsby-plugin-typescript',\n  'gatsby-plugin-typescript-checker',\n...\n</code></pre>","frontmatter":{"title":"Installing Typescript on richsoni.com","hero":"/images/posts/gatsby-logo.jpg"},"fields":{"date":"2018-12-10"}}},"pageContext":{"url":"/posts/2018-12-10-installing-typescript/"}}